<!-- Header -->
<header class="sticky top-0 z-50 bg-white shadow-lg border-b border-gray-200">
  <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-16">
      <!-- Logo and Brand -->
      <div class="flex items-center space-x-3">
        <div class="flex-shrink-0">
          <div
            class="w-10 h-10 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-lg flex items-center justify-center shadow-md"
          >
            <span class="text-white font-bold text-xl">📊</span>
          </div>
        </div>
        <div class="hidden md:block">
          <h1 class="text-xl font-bold text-gray-800">
            {{ t("header.title") }}
          </h1>
          <p class="text-xs text-gray-500">{{ t("header.subtitle") }}</p>
        </div>
        <div class="md:hidden">
          <h1 class="text-lg font-bold text-gray-800">BVC</h1>
        </div>
      </div>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center space-x-6">
        <button
          (click)="scrollToSection('graph-market-data')"
          class="text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200 flex items-center space-x-1"
        >
          <svg
            class="w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
            />
          </svg>
          <span>{{ t("header.charts") }}</span>
        </button>
        <button
          (click)="scrollToSection('table-market-data')"
          class="text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200 flex items-center space-x-1"
        >
          <svg
            class="w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"
            />
          </svg>
          <span>{{ t("header.data") }}</span>
        </button>
        <div class="h-8 w-px bg-gray-300"></div>

        <!-- Language Selector -->
        <div class="flex items-center space-x-2 bg-gray-100 rounded-lg p-1">
          <button
            (click)="changeLanguage('es')"
            [class.bg-blue-600]="currentLanguage === 'es'"
            [class.text-white]="currentLanguage === 'es'"
            [class.text-gray-700]="currentLanguage !== 'es'"
            class="px-3 py-1 rounded-md text-xs font-medium transition-all duration-200 flex items-center space-x-1"
          >
            <span>🇪🇸</span>
            <span>ES</span>
          </button>
          <button
            (click)="changeLanguage('en')"
            [class.bg-blue-600]="currentLanguage === 'en'"
            [class.text-white]="currentLanguage === 'en'"
            [class.text-gray-700]="currentLanguage !== 'en'"
            class="px-3 py-1 rounded-md text-xs font-medium transition-all duration-200 flex items-center space-x-1"
          >
            <span>🇺🇸</span>
            <span>EN</span>
          </button>
        </div>

        <div class="h-8 w-px bg-gray-300"></div>
        <div class="flex items-center space-x-2 text-sm">
          <div class="flex items-center space-x-1 text-gray-600">
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
              />
            </svg>
            <span class="font-medium">{{ today }}</span>
          </div>
          <div class="h-4 w-px bg-gray-300"></div>
          <div class="flex items-center space-x-1 text-gray-600">
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            <span class="font-mono font-medium">{{ currentTime }}</span>
          </div>
        </div>
      </div>

      <!-- Mobile menu button -->
      <div class="md:hidden flex items-center space-x-2">
        <div class="flex items-center space-x-1 text-xs text-gray-600">
          <svg
            class="w-3 h-3"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
            />
          </svg>
          <span class="font-mono">{{ currentTime }}</span>
        </div>
        <button
          (click)="toggleMobileMenu()"
          class="inline-flex items-center justify-center p-2 rounded-md text-gray-700 hover:text-blue-600 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 transition-colors duration-200"
        >
          <svg
            class="h-6 w-6"
            [class.hidden]="showMobileMenu"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"
            />
          </svg>
          <svg
            class="h-6 w-6"
            [class.hidden]="!showMobileMenu"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            />
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile menu -->
    <div class="md:hidden" [class.hidden]="!showMobileMenu">
      <div class="px-2 pt-2 pb-3 space-y-1 border-t border-gray-200">
        <button
          (click)="scrollToSection('graph-market-data')"
          class="w-full text-left text-gray-700 hover:text-blue-600 hover:bg-gray-50 block px-3 py-2 rounded-md text-base font-medium transition-colors duration-200"
        >
          <div class="flex items-center space-x-2">
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
              />
            </svg>
            <span>Gráficos del Mercado</span>
          </div>
        </button>
        <button
          (click)="scrollToSection('table-market-data')"
          class="w-full text-left text-gray-700 hover:text-blue-600 hover:bg-gray-50 block px-3 py-2 rounded-md text-base font-medium transition-colors duration-200"
        >
          <div class="flex items-center space-x-2">
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"
              />
            </svg>
            <span>Datos del Mercado</span>
          </div>
        </button>
        <div class="px-3 py-2 border-t border-gray-200 mt-2">
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-2 text-sm text-gray-600">
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                />
              </svg>
              <span>{{ today }}</span>
            </div>

            <!-- Language Selector Mobile -->
            <div class="flex items-center space-x-1 bg-gray-100 rounded-lg p-1">
              <button
                (click)="changeLanguage('es')"
                [class.bg-blue-600]="currentLanguage === 'es'"
                [class.text-white]="currentLanguage === 'es'"
                [class.text-gray-700]="currentLanguage !== 'es'"
                class="px-2 py-1 rounded-md text-xs font-medium transition-all duration-200"
              >
                🇪🇸
              </button>
              <button
                (click)="changeLanguage('en')"
                [class.bg-blue-600]="currentLanguage === 'en'"
                [class.text-white]="currentLanguage === 'en'"
                [class.text-gray-700]="currentLanguage !== 'en'"
                class="px-2 py-1 rounded-md text-xs font-medium transition-all duration-200"
              >
                🇺🇸
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>

<!-- Breadcrumb Sticky -->
<div class="fixed top-20 right-4 z-50 hidden lg:block">
  <div
    class="relative transition-all duration-300 ease-in-out overflow-visible"
    [class.w-12]="!showMarketPanel"
    [class.h-12]="!showMarketPanel"
    [class.w-64]="showMarketPanel"
    [class.h-auto]="showMarketPanel"
    [class.min-h-fit]="showMarketPanel"
  >
    <!-- Botón de información -->
    <button
      (click)="toggleMarketPanel()"
      class="absolute top-0 right-0 transition-all duration-300 ease-in-out z-50 cursor-pointer flex items-center justify-center rounded-lg shadow-xl hover:shadow-2xl hover:scale-110"
      [class.w-12]="true"
      [class.h-12]="true"
      [class.border-2]="true"
      [class.border-green-500]="marketStatus.isOpen"
      [class.border-red-500]="!marketStatus.isOpen"
      [class.bg-green-500]="marketStatus.isOpen"
      [class.bg-red-500]="!marketStatus.isOpen"
      [class.text-white]="true"
    >
      <!-- Icono de información -->
      <svg
        class="w-6 h-6"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
        ></path>
      </svg>
    </button>

    <!-- Panel expandido -->
    <div
      *ngIf="showMarketPanel"
      class="absolute top-0 right-0 w-64 bg-white border-2 border-gray-200 rounded-lg shadow-2xl z-50 transition-all duration-300 ease-in-out"
    >
      <!-- Botón de cerrar -->
      <button
        (click)="toggleMarketPanel()"
        class="absolute top-2 right-2 w-6 h-6 flex items-center justify-center rounded-full bg-gray-100 hover:bg-gray-200 text-gray-600 hover:text-gray-800 transition-colors duration-200"
        title="Cerrar panel"
      >
        <svg
          class="w-4 h-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          ></path>
        </svg>
      </button>

      <!-- Contenido del panel -->
      <div class="p-4">
        <div class="flex items-center space-x-3 mb-3">
          <div
            class="w-8 h-8 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-lg flex items-center justify-center"
          >
            <span class="text-white font-bold text-sm">📊</span>
          </div>
          <div>
            <h3 class="text-sm font-bold text-gray-800">
              {{ t("market.status") }}
            </h3>
            <p class="text-xs text-gray-500">{{ today }}</p>
          </div>
        </div>

        <!-- Estado del Mercado -->
        <div class="flex items-center justify-between mb-3">
          <span class="text-sm font-medium text-gray-700"
            >{{ t("market.status") }}:</span
          >
          <div class="flex items-center space-x-2">
            <div
              class="w-3 h-3 rounded-full {{
                marketStatus.statusClass
              }} animate-pulse"
            ></div>
            <span
              class="text-sm font-semibold"
              [class.text-green-600]="marketStatus.isOpen"
              [class.text-red-600]="!marketStatus.isOpen"
            >
              {{ marketStatus.status }}
            </span>
          </div>
        </div>

        <!-- Hora Actual -->
        <div class="border-t border-gray-200 pt-3">
          <div class="flex items-center justify-between">
            <span class="text-xs text-gray-500"
              >{{ t("footer.currentTime") }}:</span
            >
            <span class="text-sm font-mono font-bold text-gray-800">{{
              currentTime
            }}</span>
          </div>
        </div>

        <!-- Horario del Mercado -->
        <div class="mt-3 pt-3 border-t border-gray-200">
          <div class="text-xs text-gray-500">
            <div class="flex items-center justify-between mb-1">
              <span>Horario:</span>
              <span class="font-semibold">9:00 AM - 1:00 PM</span>
            </div>
            <div class="text-center">
              <span class="text-xs text-gray-400">
                {{
                  marketStatus.isOpen
                    ? "🟢 Mercado activo"
                    : "🔴 Mercado cerrado"
                }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div
  class="min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 p-4 md:p-8 w-full relative"
>
  <div class="w-full">
    <div
      class="text-gray-600 text-justify p-4 rounded-lg my-4 w-full border-l-4 border-blue-400 bg-blue-50 shadow-sm"
      style="
        background: linear-gradient(
          90deg,
          rgba(219, 234, 254, 0.98) 60%,
          rgba(191, 219, 254, 0.85) 100%
        );
      "
    >
      {{ t("banner.freeSystem") }}
      <a href="https://www.bolsadecaracas.com/" target="_blank">{{
        t("banner.officialSite")
      }}</a
      >.
    </div>

    <div
      class="text-gray-600 text-justify p-4 rounded-lg my-4 w-full border-l-4 border-blue-400 bg-blue-50 shadow-sm"
      style="
        background: linear-gradient(
          90deg,
          rgba(254, 243, 199, 0.98) 60%,
          rgba(253, 230, 138, 0.85) 100%
        );
      "
    >
      {{ t("banner.currency") }}
    </div>
  </div>

  <section id="graph-market-data" class="py-8">
    <div class="max-w-7xl mx-auto mb-8">
      <h2 class="text-3xl font-bold text-gray-800 mb-2">
        📊 {{ t("charts.title") }}
      </h2>
      <p class="text-gray-600">
        {{ t("charts.subtitle") }}
      </p>
    </div>
    <app-market-charts
      *ngIf="!loading && !error && marketData.length > 0"
      [marketData]="marketData"
    >
    </app-market-charts>

    <!-- Instrumentos Destacados -->
    <div
      *ngIf="!loading && !error && marketData.length > 0"
      class="max-w-7xl mx-auto mt-8"
    >
      <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">
        🌟 {{ t("top.title") }}
      </h3>

      <div class="grid md:grid-cols-2 gap-6">
        <!-- Destacado de Ayer -->
        <div
          *ngIf="getTopPerformerYesterday() as topYesterday"
          class="bg-gradient-to-br from-purple-50 to-indigo-100 rounded-xl shadow-lg p-6 border-2 border-purple-300 hover:shadow-xl transition-all duration-300"
        >
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center space-x-3">
              <div
                class="w-12 h-12 bg-gradient-to-br from-purple-600 to-indigo-700 rounded-lg flex items-center justify-center shadow-md"
              >
                <span class="text-white font-bold text-xl">📆</span>
              </div>
              <div>
                <h4 class="text-lg font-bold text-gray-800">
                  {{ t("top.yesterday") }}
                </h4>
                <p class="text-xs text-gray-600">
                  {{ t("top.yesterdayDesc") }}
                </p>
              </div>
            </div>
          </div>

          <div class="bg-white rounded-lg p-4 shadow-inner">
            <div class="flex items-center justify-between mb-3">
              <div>
                <div class="text-2xl font-bold text-gray-900">
                  {{ topYesterday.market.symbol }}
                </div>
                <div class="text-sm text-gray-600">
                  {{ topYesterday.market.description }}
                </div>
              </div>
              <div class="text-right">
                <div class="text-3xl font-bold text-purple-900">
                  ${{ formatNumber(topYesterday.history.price) }}
                </div>
                <div class="text-green-600 font-bold text-xl">
                  +{{ formatNumber(topYesterday.history.relative_variation) }}%
                </div>
              </div>
            </div>

            <div
              class="grid grid-cols-2 gap-3 mt-4 pt-4 border-t border-gray-200"
            >
              <div>
                <div class="text-xs text-gray-500 uppercase">
                  {{ t("common.volume") }}
                </div>
                <div class="text-sm font-semibold text-gray-900">
                  {{ formatVolume(topYesterday.history.volume) }}
                </div>
              </div>
              <div>
                <div class="text-xs text-gray-500 uppercase">
                  {{ t("common.amount") }}
                </div>
                <div class="text-sm font-semibold text-gray-900">
                  {{ formatCurrency(topYesterday.history.effective_amount) }}
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Destacado de Hoy -->
        <div
          *ngIf="getTopPerformerToday() as topToday"
          class="bg-gradient-to-br from-green-50 to-emerald-100 rounded-xl shadow-lg p-6 border-2 border-green-300 hover:shadow-xl transition-all duration-300"
        >
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center space-x-3">
              <div
                class="w-12 h-12 bg-gradient-to-br from-green-600 to-emerald-700 rounded-lg flex items-center justify-center shadow-md animate-pulse"
              >
                <span class="text-white font-bold text-xl">⭐</span>
              </div>
              <div>
                <h4 class="text-lg font-bold text-gray-800">
                  {{ t("top.today") }}
                </h4>
                <p class="text-xs text-gray-600">
                  {{ t("top.todayDesc") }}
                </p>
              </div>
            </div>
          </div>

          <div class="bg-white rounded-lg p-4 shadow-inner">
            <div class="flex items-center justify-between mb-3">
              <div>
                <div class="text-2xl font-bold text-gray-900">
                  {{ topToday.market.symbol }}
                </div>
                <div class="text-sm text-gray-600">
                  {{ topToday.market.description }}
                </div>
              </div>
              <div class="text-right">
                <div class="text-3xl font-bold text-green-900">
                  ${{ formatNumber(topToday.history.price) }}
                </div>
                <div class="text-green-600 font-bold text-xl">
                  +{{ formatNumber(topToday.history.relative_variation) }}%
                </div>
              </div>
            </div>

            <div
              class="grid grid-cols-2 gap-3 mt-4 pt-4 border-t border-gray-200"
            >
              <div>
                <div class="text-xs text-gray-500 uppercase">
                  {{ t("common.volume") }}
                </div>
                <div class="text-sm font-semibold text-gray-900">
                  {{ formatVolume(topToday.history.volume) }}
                </div>
              </div>
              <div>
                <div class="text-xs text-gray-500 uppercase">
                  {{ t("common.amount") }}
                </div>
                <div class="text-sm font-semibold text-gray-900">
                  {{ formatCurrency(topToday.history.effective_amount) }}
                </div>
              </div>
            </div>

            <div class="mt-3 pt-3 border-t border-gray-200">
              <div
                class="flex items-center justify-between text-xs text-gray-600"
              >
                <span class="flex items-center space-x-1">
                  <svg
                    class="w-3 h-3"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                    />
                  </svg>
                  <span>{{ topToday.history.market_time }}</span>
                </span>
                <span class="font-semibold text-green-600"
                  >🔥 {{ t("top.live") }}</span
                >
              </div>
            </div>
          </div>
        </div>

        <!-- Mensaje si no hay datos -->
        <div
          *ngIf="!getTopPerformerYesterday()"
          class="bg-gray-50 rounded-xl p-6 border-2 border-gray-200 flex items-center justify-center"
        >
          <div class="text-center text-gray-500">
            <svg
              class="w-12 h-12 mx-auto mb-2 text-gray-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
              />
            </svg>
            <p class="text-sm">{{ t("top.noYesterdayData") }}</p>
          </div>
        </div>

        <div
          *ngIf="!getTopPerformerToday()"
          class="bg-gray-50 rounded-xl p-6 border-2 border-gray-200 flex items-center justify-center"
        >
          <div class="text-center text-gray-500">
            <svg
              class="w-12 h-12 mx-auto mb-2 text-gray-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            <p class="text-sm">{{ t("top.noTodayData") }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Instrumentos con Menor Rendimiento -->
    <div
      *ngIf="!loading && !error && marketData.length > 0"
      class="max-w-7xl mx-auto mt-8"
    >
      <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">
        {{ t("worst.title") }}
      </h3>

      <div class="grid md:grid-cols-2 gap-6">
        <!-- Menor Rendimiento de Ayer -->
        <div
          *ngIf="getWorstPerformerYesterday() as worstYesterday"
          class="bg-gradient-to-br from-red-50 to-orange-100 rounded-xl shadow-lg p-6 border-2 border-red-300 hover:shadow-xl transition-all duration-300"
        >
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center space-x-3">
              <div
                class="w-12 h-12 bg-gradient-to-br from-red-600 to-orange-700 rounded-lg flex items-center justify-center shadow-md"
              >
                <span class="text-white font-bold text-xl">📉</span>
              </div>
              <div>
                <h4 class="text-lg font-bold text-gray-800">
                  {{ t("worst.yesterday") }}
                </h4>
                <p class="text-xs text-gray-600">
                  {{ t("worst.yesterdayDesc") }}
                </p>
              </div>
            </div>
          </div>

          <div class="bg-white rounded-lg p-4 shadow-inner">
            <div class="flex items-center justify-between mb-3">
              <div>
                <div class="text-2xl font-bold text-gray-900">
                  {{ worstYesterday.market.symbol }}
                </div>
                <div class="text-sm text-gray-600">
                  {{ worstYesterday.market.description }}
                </div>
              </div>
              <div class="text-right">
                <div class="text-3xl font-bold text-red-900">
                  ${{ formatNumber(worstYesterday.history.price) }}
                </div>
                <div class="text-red-600 font-bold text-xl">
                  {{ formatNumber(worstYesterday.history.relative_variation) }}%
                </div>
              </div>
            </div>

            <div
              class="grid grid-cols-2 gap-3 mt-4 pt-4 border-t border-gray-200"
            >
              <div>
                <div class="text-xs text-gray-500 uppercase">
                  {{ t("common.volume") }}
                </div>
                <div class="text-sm font-semibold text-gray-900">
                  {{ formatVolume(worstYesterday.history.volume) }}
                </div>
              </div>
              <div>
                <div class="text-xs text-gray-500 uppercase">
                  {{ t("common.amount") }}
                </div>
                <div class="text-sm font-semibold text-gray-900">
                  {{ formatCurrency(worstYesterday.history.effective_amount) }}
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Menor Rendimiento de Hoy -->
        <div
          *ngIf="getWorstPerformerToday() as worstToday"
          class="bg-gradient-to-br from-orange-50 to-red-100 rounded-xl shadow-lg p-6 border-2 border-orange-300 hover:shadow-xl transition-all duration-300"
        >
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center space-x-3">
              <div
                class="w-12 h-12 bg-gradient-to-br from-orange-600 to-red-700 rounded-lg flex items-center justify-center shadow-md animate-pulse"
              >
                <span class="text-white font-bold text-xl">🔻</span>
              </div>
              <div>
                <h4 class="text-lg font-bold text-gray-800">
                  {{ t("worst.today") }}
                </h4>
                <p class="text-xs text-gray-600">
                  {{ t("worst.todayDesc") }}
                </p>
              </div>
            </div>
          </div>

          <div class="bg-white rounded-lg p-4 shadow-inner">
            <div class="flex items-center justify-between mb-3">
              <div>
                <div class="text-2xl font-bold text-gray-900">
                  {{ worstToday.market.symbol }}
                </div>
                <div class="text-sm text-gray-600">
                  {{ worstToday.market.description }}
                </div>
              </div>
              <div class="text-right">
                <div class="text-3xl font-bold text-orange-900">
                  ${{ formatNumber(worstToday.history.price) }}
                </div>
                <div class="text-red-600 font-bold text-xl">
                  {{ formatNumber(worstToday.history.relative_variation) }}%
                </div>
              </div>
            </div>

            <div
              class="grid grid-cols-2 gap-3 mt-4 pt-4 border-t border-gray-200"
            >
              <div>
                <div class="text-xs text-gray-500 uppercase">
                  {{ t("common.volume") }}
                </div>
                <div class="text-sm font-semibold text-gray-900">
                  {{ formatVolume(worstToday.history.volume) }}
                </div>
              </div>
              <div>
                <div class="text-xs text-gray-500 uppercase">
                  {{ t("common.amount") }}
                </div>
                <div class="text-sm font-semibold text-gray-900">
                  {{ formatCurrency(worstToday.history.effective_amount) }}
                </div>
              </div>
            </div>

            <div class="mt-3 pt-3 border-t border-gray-200">
              <div
                class="flex items-center justify-between text-xs text-gray-600"
              >
                <span class="flex items-center space-x-1">
                  <svg
                    class="w-3 h-3"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                    />
                  </svg>
                  <span>{{ worstToday.history.market_time }}</span>
                </span>
                <span class="font-semibold text-red-600"
                  >⚠️ {{ t("top.live") }}</span
                >
              </div>
            </div>
          </div>
        </div>

        <!-- Mensaje si no hay datos -->
        <div
          *ngIf="!getWorstPerformerYesterday()"
          class="bg-gray-50 rounded-xl p-6 border-2 border-gray-200 flex items-center justify-center"
        >
          <div class="text-center text-gray-500">
            <svg
              class="w-12 h-12 mx-auto mb-2 text-gray-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
              />
            </svg>
            <p class="text-sm">{{ t("worst.noYesterdayData") }}</p>
          </div>
        </div>

        <div
          *ngIf="!getWorstPerformerToday()"
          class="bg-gray-50 rounded-xl p-6 border-2 border-gray-200 flex items-center justify-center"
        >
          <div class="text-center text-gray-500">
            <svg
              class="w-12 h-12 mx-auto mb-2 text-gray-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            <p class="text-sm">{{ t("worst.noTodayData") }}</p>
          </div>
        </div>
      </div>
    </div>
  </section>
  <section id="table-market-data">
    <div class="max-w-7xl mx-auto">
      <!-- Header -->
      <div class="mb-8">
        <h1 class="text-4xl font-bold text-gray-800 mb-2">
          📈 {{ t("table.title") }}: {{ today }}
        </h1>
        <p class="text-gray-600">
          {{ t("table.subtitle") }}
        </p>
      </div>

      <!-- Search Bar -->
      <div *ngIf="!loading && !error" class="mb-6">
        <div class="flex gap-3 max-w-2xl">
          <div class="relative flex-1">
            <div
              class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"
            >
              <svg
                class="h-5 w-5 text-gray-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                />
              </svg>
            </div>
            <input
              type="text"
              [value]="searchTerm"
              (input)="onSearch($event)"
              [placeholder]="t('table.searchPlaceholder')"
              class="block w-full pl-12 pr-12 py-3 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-all duration-200"
            />
            <div
              *ngIf="searchTerm"
              class="absolute inset-y-0 right-0 pr-3 flex items-center"
            >
              <button
                (click)="clearSearch()"
                class="p-1 rounded-full hover:bg-gray-100 transition-colors duration-150"
                title="Limpiar búsqueda"
              >
                <svg
                  class="h-5 w-5 text-gray-400 hover:text-gray-600"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"
                  />
                </svg>
              </button>
            </div>
          </div>

          <!-- Botón de Refrescar -->
          <button
            (click)="getMarketData()"
            [disabled]="loading"
            class="px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg shadow-md transition-all duration-200 flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed group"
            title="Actualizar datos"
          >
            <svg
              class="h-5 w-5 transition-transform duration-500"
              [class.animate-spin]="loading"
              [class.group-hover:rotate-180]="!loading"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
              />
            </svg>
            <span class="hidden sm:inline font-medium">{{
              t("table.refresh")
            }}</span>
          </button>
        </div>
        <div
          *ngIf="searchTerm && filteredMarketData.length > 0"
          class="mt-2 text-sm text-gray-600"
        >
          {{ t("table.found") }}
          <span class="font-semibold text-blue-600">{{
            filteredMarketData.length
          }}</span>
          {{ t("table.results") }}
        </div>
        <div
          *ngIf="searchTerm && filteredMarketData.length === 0"
          class="mt-2 text-sm text-amber-600"
        >
          {{ t("table.noResults") }} "{{ searchTerm }}"
        </div>
      </div>

      <!-- Filtros -->
      <div *ngIf="!loading && !error" class="mb-6">
        <div class="flex flex-wrap gap-3 items-center">
          <span class="text-sm font-medium text-gray-700"
            >{{ t("filters.title") }}:</span
          >

          <button
            (click)="setFilter('all')"
            [class.bg-blue-600]="currentFilter === 'all'"
            [class.text-white]="currentFilter === 'all'"
            [class.bg-gray-100]="currentFilter !== 'all'"
            [class.text-gray-700]="currentFilter !== 'all'"
            class="px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 hover:shadow-md"
          >
            {{ t("filters.all") }}
          </button>

          <button
            (click)="setFilter('gainers')"
            [class.bg-green-600]="currentFilter === 'gainers'"
            [class.text-white]="currentFilter === 'gainers'"
            [class.bg-gray-100]="currentFilter !== 'gainers'"
            [class.text-gray-700]="currentFilter !== 'gainers'"
            class="px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 hover:shadow-md flex items-center space-x-1"
          >
            <span>📈</span>
            <span>{{ t("filters.gainers") }}</span>
          </button>

          <button
            (click)="setFilter('losers')"
            [class.bg-red-600]="currentFilter === 'losers'"
            [class.text-white]="currentFilter === 'losers'"
            [class.bg-gray-100]="currentFilter !== 'losers'"
            [class.text-gray-700]="currentFilter !== 'losers'"
            class="px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 hover:shadow-md flex items-center space-x-1"
          >
            <span>📉</span>
            <span>{{ t("filters.losers") }}</span>
          </button>
        </div>
      </div>

      <!-- Loading State -->
      <div *ngIf="loading" class="flex justify-center items-center py-20">
        <div
          class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"
        ></div>
      </div>

      <!-- Error State -->
      <div
        *ngIf="error"
        class="bg-red-50 border-l-4 border-red-500 p-4 rounded-lg"
      >
        <p class="text-red-700">{{ error }}</p>
      </div>

      <!-- Tables Container with Animation -->
      <div *ngIf="!loading && !error" class="relative overflow-hidden">
        <!-- Main Table -->
        <div
          class="bg-white rounded-xl shadow-xl overflow-hidden transition-transform duration-500 ease-in-out"
          [class.transform]="showHistoryTable"
          [class.-translate-x-full]="showHistoryTable"
        >
          <!-- Desktop Table -->
          <div
            class="hidden md:block overflow-x-auto max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-blue-500 scrollbar-track-gray-200"
          >
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gradient-to-r from-blue-600 to-indigo-700">
                <tr>
                  <th
                    (click)="sortTable('symbol')"
                    class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider cursor-pointer hover:bg-blue-700 transition-colors duration-200"
                  >
                    {{ t("table.symbol") }} {{ getSortIcon("symbol") }}
                  </th>
                  <th
                    (click)="sortTable('description')"
                    class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider cursor-pointer hover:bg-blue-700 transition-colors duration-200"
                  >
                    {{ t("table.description") }}
                    {{ getSortIcon("description") }}
                  </th>
                  <th
                    (click)="sortTable('price')"
                    class="px-6 py-4 text-right text-xs font-semibold text-white uppercase tracking-wider cursor-pointer hover:bg-blue-700 transition-colors duration-200"
                  >
                    {{ t("table.price") }} {{ getSortIcon("price") }}
                  </th>
                  <th
                    (click)="sortTable('variation')"
                    class="px-6 py-4 text-right text-xs font-semibold text-white uppercase tracking-wider cursor-pointer hover:bg-blue-700 transition-colors duration-200"
                  >
                    {{ t("table.variation") }} {{ getSortIcon("variation") }}
                  </th>
                  <th
                    (click)="sortTable('volume')"
                    class="px-6 py-4 text-right text-xs font-semibold text-white uppercase tracking-wider cursor-pointer hover:bg-blue-700 transition-colors duration-200"
                  >
                    {{ t("table.volume") }} {{ getSortIcon("volume") }}
                  </th>
                  <th
                    (click)="sortTable('amount')"
                    class="px-6 py-4 text-right text-xs font-semibold text-white uppercase tracking-wider cursor-pointer hover:bg-blue-700 transition-colors duration-200"
                  >
                    {{ t("table.amount") }} {{ getSortIcon("amount") }}
                  </th>
                  <th
                    (click)="sortTable('time')"
                    class="px-6 py-4 text-center text-xs font-semibold text-white uppercase tracking-wider cursor-pointer hover:bg-blue-700 transition-colors duration-200"
                  >
                    {{ t("table.time") }} {{ getSortIcon("time") }}
                  </th>
                  <th
                    class="px-6 py-4 text-center text-xs font-semibold text-white uppercase tracking-wider"
                  >
                    {{ t("table.actions") }}
                  </th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <tr
                  *ngFor="let market of filteredMarketData; let i = index"
                  class="hover:bg-blue-50 transition-colors duration-150"
                  [class.bg-gray-50]="i % 2 === 0"
                >
                  <ng-container *ngIf="getLastHistory(market) as lastHistory">
                    <!-- Symbol -->
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="flex items-center">
                        <div
                          class="flex-shrink-0 h-10 w-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center p-2"
                        >
                          <!-- market.symbol.substring(0, 2) -->
                          <img
                            [src]="
                              imagePath.replace(
                                '{{symbol}}',
                                market.symbol.split('.')[0]
                              )
                            "
                          />
                        </div>
                        <div class="ml-3">
                          <div class="text-sm font-bold text-gray-900">
                            {{ market.symbol }}
                          </div>
                        </div>
                      </div>
                    </td>

                    <!-- Description -->
                    <td class="px-6 py-4">
                      <div class="text-sm text-gray-900 font-medium">
                        {{ market.description }}
                      </div>
                    </td>

                    <!-- Price -->
                    <td class="px-6 py-4 whitespace-nowrap text-right">
                      <div
                        class="text-sm font-bold"
                        [class]="
                          lastHistory.relative_variation >= 0
                            ? 'text-green-600'
                            : 'text-red-600'
                        "
                      >
                        ${{ formatNumber(lastHistory.price) }}
                      </div>
                    </td>

                    <!-- Variation -->
                    <td class="px-6 py-4 whitespace-nowrap text-right">
                      <div class="flex flex-col items-end space-y-1">
                        <span
                          [class]="
                            lastHistory.relative_variation >= 0
                              ? 'inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800'
                              : 'inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800'
                          "
                        >
                          <span *ngIf="lastHistory.relative_variation >= 0"
                            >↑</span
                          >
                          <span *ngIf="lastHistory.relative_variation < 0"
                            >↓</span
                          >
                          {{ formatNumber(lastHistory.relative_variation) }}%
                        </span>
                        <span
                          [class]="
                            lastHistory.absolute_variation >= 0
                              ? 'text-xs text-green-600'
                              : 'text-xs text-red-600'
                          "
                        >
                          {{ lastHistory.absolute_variation >= 0 ? "+" : ""
                          }}{{ formatNumber(lastHistory.absolute_variation) }}
                        </span>
                      </div>
                    </td>

                    <!-- Volume -->
                    <td class="px-6 py-4 whitespace-nowrap text-right">
                      <div
                        class="text-sm"
                        [class]="
                          lastHistory.relative_variation >= 0
                            ? 'text-green-600'
                            : 'text-red-600'
                        "
                      >
                        {{ formatVolume(lastHistory.volume) }}
                      </div>
                    </td>

                    <!-- Amount -->
                    <td class="px-6 py-4 whitespace-nowrap text-right">
                      <div class="text-sm font-medium text-gray-900">
                        {{ formatCurrency(lastHistory.effective_amount) }}
                      </div>
                    </td>

                    <!-- Time -->
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                      <span
                        class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"
                      >
                        🕐 {{ lastHistory.market_time }}
                      </span>
                    </td>

                    <!-- Actions -->
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                      <button
                        (click)="viewHistory(market)"
                        class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200"
                        title="Ver historial"
                      >
                        <svg
                          class="h-4 w-4 mr-1"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                          />
                        </svg>
                        {{ t("table.history") }}
                      </button>
                    </td>
                  </ng-container>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Mobile Cards -->
          <div
            class="md:hidden max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-blue-500 scrollbar-track-gray-200"
          >
            <div
              *ngFor="let market of filteredMarketData; let i = index"
              class="border-b border-gray-200 last:border-b-0"
            >
              <ng-container *ngIf="getLastHistory(market) as lastHistory">
                <div
                  class="p-4 hover:bg-blue-50 transition-colors duration-150"
                >
                  <!-- Header -->
                  <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center">
                      <div
                        class="flex-shrink-0 h-12 w-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center"
                      >
                        <span class="text-white font-bold">{{
                          market.symbol.substring(0, 2)
                        }}</span>
                      </div>
                      <div class="ml-3">
                        <div class="text-sm font-bold text-gray-900">
                          {{ market.symbol }}
                        </div>
                        <div class="text-xs text-gray-500">
                          {{ market.description }}
                        </div>
                      </div>
                    </div>
                    <div class="text-right">
                      <div
                        class="text-lg font-bold"
                        [class]="
                          lastHistory.relative_variation >= 0
                            ? 'text-green-600'
                            : 'text-red-600'
                        "
                      >
                        ${{ formatNumber(lastHistory.price) }}
                      </div>
                      <span
                        [class]="
                          lastHistory.relative_variation >= 0
                            ? 'inline-flex px-2 py-0.5 text-xs font-semibold rounded-full bg-green-100 text-green-800'
                            : 'inline-flex px-2 py-0.5 text-xs font-semibold rounded-full bg-red-100 text-red-800'
                        "
                      >
                        {{ lastHistory.relative_variation >= 0 ? "↑" : "↓" }}
                        {{ formatNumber(lastHistory.relative_variation) }}%
                      </span>
                    </div>
                  </div>

                  <!-- Details Grid -->
                  <div class="grid grid-cols-2 gap-3 mt-3">
                    <div class="bg-gray-50 rounded-lg p-2">
                      <div class="text-xs text-gray-500">Volumen</div>
                      <div
                        class="text-sm font-semibold"
                        [class]="
                          lastHistory.relative_variation >= 0
                            ? 'text-green-600'
                            : 'text-red-600'
                        "
                      >
                        {{ formatVolume(lastHistory.volume) }}
                      </div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-2">
                      <div class="text-xs text-gray-500">Monto</div>
                      <div class="text-sm font-semibold text-gray-900">
                        {{ formatCurrency(lastHistory.effective_amount) }}
                      </div>
                    </div>
                  </div>

                  <!-- Footer -->
                  <div class="mt-3 flex justify-between items-center">
                    <span class="text-xs text-gray-500">
                      Var. Abs:
                      <span
                        [class]="
                          lastHistory.absolute_variation >= 0
                            ? 'text-green-600 font-semibold'
                            : 'text-red-600 font-semibold'
                        "
                      >
                        {{ lastHistory.absolute_variation >= 0 ? "+" : ""
                        }}{{ formatNumber(lastHistory.absolute_variation) }}
                      </span>
                    </span>
                    <div class="flex items-center space-x-2">
                      <span
                        class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"
                      >
                        🕐 {{ lastHistory.market_time }}
                      </span>
                      <button
                        (click)="viewHistory(market)"
                        class="inline-flex items-center px-2 py-1 border border-gray-300 shadow-sm text-xs leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200"
                        title="Ver historial"
                      >
                        <svg
                          class="h-3 w-3 mr-1"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                          />
                        </svg>
                        {{ t("table.history") }}
                      </button>
                    </div>
                  </div>
                </div>
              </ng-container>
            </div>
          </div>
        </div>

        <!-- History Table -->
        <div
          class="absolute top-0 left-0 w-full bg-white rounded-xl shadow-xl overflow-hidden transition-transform duration-500 ease-in-out"
          [class.transform]="showHistoryTable"
          [class.translate-x-0]="showHistoryTable"
          [class.translate-x-full]="!showHistoryTable"
        >
          <!-- History Header -->
          <div class="bg-gradient-to-r from-green-600 to-emerald-700 px-6 py-4">
            <div class="flex items-center justify-between">
              <div>
                <h3 class="text-lg font-bold text-white">
                  📊 Historial de {{ selectedMarket?.symbol }}
                </h3>
                <p class="text-green-100 text-sm">
                  {{ selectedMarket?.description }}
                </p>
              </div>
              <button
                (click)="backToMainTable()"
                class="inline-flex items-center px-4 py-2 border border-white shadow-sm text-sm leading-4 font-medium rounded-md text-green-600 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-all duration-200"
              >
                <svg
                  class="h-4 w-4 mr-2"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M10 19l-7-7m0 0l7-7m-7 7h18"
                  />
                </svg>
                Volver
              </button>
            </div>
          </div>

          <!-- History Desktop Table -->
          <div
            class="hidden md:block overflow-x-auto max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-green-500 scrollbar-track-gray-200"
          >
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th
                    (click)="sortHistory('date')"
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors duration-200"
                  >
                    Fecha {{ getHistorySortIcon("date") }}
                  </th>
                  <th
                    (click)="sortHistory('time')"
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors duration-200"
                  >
                    Hora {{ getHistorySortIcon("time") }}
                  </th>
                  <th
                    (click)="sortHistory('price')"
                    class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors duration-200"
                  >
                    Precio ($) {{ getHistorySortIcon("price") }}
                  </th>
                  <th
                    (click)="sortHistory('variation')"
                    class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors duration-200"
                  >
                    Variación % {{ getHistorySortIcon("variation") }}
                  </th>
                  <th
                    (click)="sortHistory('volume')"
                    class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors duration-200"
                  >
                    Volumen {{ getHistorySortIcon("volume") }}
                  </th>
                  <th
                    (click)="sortHistory('amount')"
                    class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors duration-200"
                  >
                    Monto ($) {{ getHistorySortIcon("amount") }}
                  </th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <tr
                  *ngFor="let history of selectedMarket?.history; let i = index"
                  class="hover:bg-green-50 transition-colors duration-150"
                  [class.bg-gray-50]="i % 2 === 0"
                >
                  <!-- Time -->
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    <span
                      class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"
                    >
                      🕐 {{ history.timestamp }}
                    </span>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    <span
                      class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"
                    >
                      🕐 {{ history.market_time }}
                    </span>
                  </td>

                  <!-- Price -->
                  <td class="px-6 py-4 whitespace-nowrap text-right">
                    <div
                      class="text-sm font-bold"
                      [class]="
                        history.relative_variation >= 0
                          ? 'text-green-600'
                          : 'text-red-600'
                      "
                    >
                      ${{ formatNumber(history.price) }}
                    </div>
                  </td>

                  <!-- Variation -->
                  <td class="px-6 py-4 whitespace-nowrap text-right">
                    <div class="flex flex-col items-end space-y-1">
                      <span
                        [class]="
                          history.relative_variation >= 0
                            ? 'inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800'
                            : 'inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800'
                        "
                      >
                        <span *ngIf="history.relative_variation >= 0">↑</span>
                        <span *ngIf="history.relative_variation < 0">↓</span>
                        {{ formatNumber(history.relative_variation) }}%
                      </span>
                      <span
                        [class]="
                          history.absolute_variation >= 0
                            ? 'text-xs text-green-600'
                            : 'text-xs text-red-600'
                        "
                      >
                        {{ history.absolute_variation >= 0 ? "+" : ""
                        }}{{ formatNumber(history.absolute_variation) }}
                      </span>
                    </div>
                  </td>

                  <!-- Volume -->
                  <td class="px-6 py-4 whitespace-nowrap text-right">
                    <div
                      class="text-sm"
                      [class]="
                        history.relative_variation >= 0
                          ? 'text-green-600'
                          : 'text-red-600'
                      "
                    >
                      {{ formatVolume(history.volume) }}
                    </div>
                  </td>

                  <!-- Amount -->
                  <td class="px-6 py-4 whitespace-nowrap text-right">
                    <div class="text-sm font-medium text-gray-900">
                      {{ formatCurrency(history.effective_amount) }}
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- History Mobile Cards -->
          <div
            class="md:hidden max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-green-500 scrollbar-track-gray-200"
          >
            <div
              *ngFor="let history of selectedMarket?.history; let i = index"
              class="border-b border-gray-200 last:border-b-0"
            >
              <div class="p-4 hover:bg-green-50 transition-colors duration-150">
                <!-- Header -->
                <div class="flex items-center justify-between mb-3">
                  <div class="flex items-center">
                    <span
                      class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"
                    >
                      🕐 {{ history.market_time }}
                    </span>
                  </div>
                  <div class="text-right">
                    <div
                      class="text-lg font-bold"
                      [class]="
                        history.relative_variation >= 0
                          ? 'text-green-600'
                          : 'text-red-600'
                      "
                    >
                      ${{ formatNumber(history.price) }}
                    </div>
                    <span
                      [class]="
                        history.relative_variation >= 0
                          ? 'inline-flex px-2 py-0.5 text-xs font-semibold rounded-full bg-green-100 text-green-800'
                          : 'inline-flex px-2 py-0.5 text-xs font-semibold rounded-full bg-red-100 text-red-800'
                      "
                    >
                      {{ history.relative_variation >= 0 ? "↑" : "↓" }}
                      {{ formatNumber(history.relative_variation) }}%
                    </span>
                  </div>
                </div>

                <!-- Details Grid -->
                <div class="grid grid-cols-2 gap-3 mt-3">
                  <div class="bg-gray-50 rounded-lg p-2">
                    <div class="text-xs text-gray-500">Volumen</div>
                    <div
                      class="text-sm font-semibold"
                      [class]="
                        history.relative_variation >= 0
                          ? 'text-green-600'
                          : 'text-red-600'
                      "
                    >
                      {{ formatVolume(history.volume) }}
                    </div>
                  </div>
                  <div class="bg-gray-50 rounded-lg p-2">
                    <div class="text-xs text-gray-500">Monto</div>
                    <div class="text-sm font-semibold text-gray-900">
                      {{ formatCurrency(history.effective_amount) }}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer Info -->
      <div
        *ngIf="!loading && !error && filteredMarketData.length > 0"
        class="mt-6 text-center"
      >
        <p class="text-sm text-gray-600">
          <span *ngIf="!searchTerm">
            {{ t("table.totalInstruments") }}
            <span class="font-semibold text-gray-900">{{
              filteredMarketData.length
            }}</span>
          </span>
          <span *ngIf="searchTerm">
            {{ t("table.showing") }}
            <span class="font-semibold text-blue-600">{{
              filteredMarketData.length
            }}</span>
            {{ t("table.of") }}
            <span class="font-semibold text-gray-900">{{
              marketData.length
            }}</span>
            {{ t("charts.instrumentsSelected") }}s
          </span>
        </p>
      </div>

      <!-- Empty State -->
      <div
        *ngIf="!loading && !error && marketData.length === 0"
        class="text-center py-12"
      >
        <p class="text-gray-500 text-lg">
          {{ t("table.noDataAvailable") }}
        </p>
      </div>
    </div>
  </section>
</div>

<!-- Footer -->
<footer class="bg-gradient-to-r from-gray-800 to-gray-900 text-white">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
      <!-- About Section -->
      <div>
        <div class="flex items-center space-x-2 mb-4">
          <div
            class="w-8 h-8 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-lg flex items-center justify-center"
          >
            <span class="text-white font-bold">📊</span>
          </div>
          <h3 class="text-lg font-bold">BVC</h3>
        </div>
        <p class="text-gray-400 text-sm">
          {{ t("footer.aboutText") }}
        </p>
      </div>

      <!-- Quick Links -->
      <div>
        <h3 class="text-lg font-bold mb-4">
          {{ t("footer.quickLinksTitle") }}
        </h3>
        <ul class="space-y-2">
          <li>
            <button
              (click)="scrollToSection('graph-market-data')"
              class="text-gray-400 hover:text-white transition-colors duration-200 text-sm flex items-center space-x-1"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5l7 7-7 7"
                />
              </svg>
              <span>{{ t("footer.chartsLink") }}</span>
            </button>
          </li>
          <li>
            <button
              (click)="scrollToSection('table-market-data')"
              class="text-gray-400 hover:text-white transition-colors duration-200 text-sm flex items-center space-x-1"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5l7 7-7 7"
                />
              </svg>
              <span>{{ t("footer.dataLink") }}</span>
            </button>
          </li>
        </ul>
      </div>

      <!-- Contact Info -->
      <div>
        <h3 class="text-lg font-bold mb-4">{{ t("footer.infoTitle") }}</h3>
        <ul class="space-y-2 text-sm text-gray-400">
          <li class="flex items-center space-x-2">
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
              />
            </svg>
            <span>{{ t("footer.lastUpdate") }} {{ today }}</span>
          </li>
          <li class="flex items-center space-x-2">
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            <span>{{ t("footer.currentTime") }} {{ currentTime }}</span>
          </li>
          <li class="flex items-center space-x-2">
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            <span>{{ t("footer.status") }} {{ t("footer.online") }}</span>
          </li>
        </ul>
      </div>
    </div>

    <!-- Bottom Bar -->
    <div class="border-t border-gray-700 mt-8 pt-6">
      <div
        class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0"
      >
        <p class="text-gray-400 text-sm">
          - {{ today.split("/")[2] }} {{ t("footer.rights") }}
          <a href="https://www.bolsadecaracas.com/" target="_blank"
            >https://www.bolsadecaracas.com/</a
          >
        </p>
        <div class="flex items-center space-x-4 text-sm text-gray-400">
          <span class="flex items-center space-x-1">
            <span>{{ t("footer.developedWith") }}</span>
            <svg
              class="w-4 h-4 text-red-500"
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path
                fill-rule="evenodd"
                d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z"
                clip-rule="evenodd"
              />
            </svg>
            <span>{{ t("footer.community") }}</span>
          </span>
        </div>
      </div>
    </div>
  </div>
</footer>
